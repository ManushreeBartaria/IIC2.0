<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Crime Map</title>
</head>
<body>
    <h1>Real-time Crime Map</h1>
    <button onclick="getAndSendLocation()">Show Map for My Location</button>
    <div id="map-container"></div>

    <script>
        function getAndSendLocation() {
            // Check if the browser supports the Geolocation API
            if ("geolocation" in navigator) {
                // Get the current position
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;

                        // Send the location data to the FastAPI endpoint
                        sendLocationToAPI(latitude, longitude);
                    },
                    (error) => {
                        // Handle errors, e.g., if the user denies location access
                        alert("Error getting your location: " + error.message);
                    }
                );
            } else {
                alert("Geolocation is not supported by your browser.");
            }
        }

        function sendLocationToAPI(latitude, longitude) {
            // The URL for your FastAPI endpoint
            const apiUrl = 'http://127.0.0.1:8000/generate_map/';

            // Prepare the data to be sent as a JSON object
            const data = {
                latitude: latitude,
                longitude: longitude
            };

            // Use the fetch API to send a POST request
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                // Display the map returned by the API in the map-container div
                document.getElementById('map-container').innerHTML = result.map_html;
            })
            .catch(error => {
                console.error('Error:', error);
                alert("An error occurred while fetching the map.");
            });
        }
    </script>
</body>
</html>